<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      Dev Tricks
    </title>
    <meta name="description" content="dev tricks about web">
    <link rel="stylesheet" href="/dev-tricks/assets/style.56d02f33.css">
    <link rel="modulepreload" href="/dev-tricks/assets/Home.c4ab07a9.js">
    <link rel="modulepreload" href="/dev-tricks/assets/app.d2ac5229.js">
    <link rel="modulepreload" href="/dev-tricks/assets/typescript_non-nullable-types-in-typescript.md.5c3e0dab.lean.js">
    <link rel="modulepreload" href="/dev-tricks/assets/app.d2ac5229.js">
    
    
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-6e7c0b86><div class="sidebar-button" data-v-6e7c0b86><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/dev-tricks/" aria-label="Dev Tricks, back to home" data-v-6e7c0b86 data-v-76c79d52><!----> Dev Tricks</a><div class="flex-grow" data-v-6e7c0b86></div><div class="nav" data-v-6e7c0b86><nav class="nav-links" data-v-6e7c0b86 data-v-f465d38e><!----><!----><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item isExternal" href="https://github.com/baooab/dev-tricks" target="_blank" rel="noopener noreferrer" data-v-99f6c566>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-99f6c566><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-58e261f2><nav class="nav-links nav" data-v-58e261f2 data-v-f465d38e><!----><!----><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item isExternal" href="https://github.com/baooab/dev-tricks" target="_blank" rel="noopener noreferrer" data-v-99f6c566>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-99f6c566><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-58e261f2><!--[--><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>最近更新</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/dev-tricks/weekly/issue-40" data-v-58e261f2>每周分享第 40 期</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/dev-tricks/weekly/issue-39" data-v-58e261f2>每周分享第 39 期</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/dev-tricks/misc/eol-lf" data-v-58e261f2>将开发环境的文件换行符设置成 LF</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/dev-tricks/weekly/issue-38" data-v-58e261f2>每周分享第 38 期</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/dev-tricks/npm/install-peerdeps" data-v-58e261f2>如何使用指定了 peerDependencies 的 npm 包</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/dev-tricks/git/vitepress-deploy-to-github" data-v-58e261f2>如何将 VitePress 部署到 GitHub Pages</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-d36a7fda><div class="container" data-v-d36a7fda><!--[--><!--]--><div class="content" data-v-d36a7fda><div data-v-d36a7fda><h1 id="typescript-中的非空类型"><a class="header-anchor" href="#typescript-中的非空类型" aria-hidden="true">#</a> TypeScript 中的非空类型</h1><blockquote><p>Marius Schulz, <a href="https://mariusschulz.com/blog/non-nullable-types-in-typescript" target="_blank" rel="noopener noreferrer">“Non-Nullable Types in TypeScript”</a>, September 28, 2016</p></blockquote><p><a href="https://blogs.msdn.microsoft.com/typescript/2016/09/22/announcing-typescript-2-0/" target="_blank" rel="noopener noreferrer">TypeScript 2.0</a> 引入了很多新特性。本篇，我将介绍 <strong>非空类型</strong>，这是对类型系统的基础功能提升，帮助我们避免了编译期间的空值错误（nullability errors）。</p><h2 id="null-和-undefined"><a class="header-anchor" href="#null-和-undefined" aria-hidden="true">#</a> <a href="#the-null-and-undefined-values">#</a> <code>null</code> 和 <code>undefined</code></h2><p>TypeScript 2.0 之前，类型检查器（type checker）允许将 <code>null</code> 和 <code>undefined</code> 赋值给 <em>任意</em> 类型。这包括字符串、数值和布尔值在内的原始类型：</p><pre><code>let name: string;
name = &quot;Marius&quot;;  // OK
name = null;      // OK
name = undefined; // OK

let age: number;
age = 24;        // OK
age = null;      // OK
age = undefined; // OK

let isMarried: boolean;
isMarried = true;      // OK
isMarried = false;     // OK
isMarried = null;      // OK
isMarried = undefined; // OK
</code></pre><p>以 <code>number</code> 类型为例。它所表示的范围不仅包括 <a href="https://en.wikipedia.org/wiki/IEEE_floating_point" target="_blank" rel="noopener noreferrer">IEEE 754 浮点数值</a>，还包括 <code>null</code> 和 <code>undefined</code>：</p><p><img src="https://mariusschulz.com/images/content/typescript_number_domain_with_null_and_undefined-2x.vzfjhvlgca.imm.png" alt="Domains of TypeScript&#39;s number type"></p><p>对象、数组和函数类型也是如此。但在这种类型系统下，无法表示非空的变量。幸运的是，TypeScript 2.0 修复了这个问题。</p><h2 id="严格空检查"><a class="header-anchor" href="#严格空检查" aria-hidden="true">#</a> <a href="#strict-null-checking">#</a>严格空检查</h2><p>TypeScritp 2.0 添加了对 <strong>非空类型（non-nullable types）</strong> 的支持。命令行中使用 <code>--strictNullChecks</code> flag 就能启用 <strong>严格空检查（strict null checking）</strong> 模式，或者在项目的 <em>tsconfig.json</em> 文件中增加 <code>strictNullChecks</code> 编译选项：</p><pre><code>{
  &quot;compilerOptions&quot;: {
    &quot;strictNullChecks&quot;: true
    // ...
  }
}
</code></pre><p>严格空检查模式下，<code>null</code> 和 <code>undefined</code> 不再能够赋值给任意类型。<code>null</code> 和 <code>undefined</code> 都归属在各自类型之下：</p><p><img src="https://mariusschulz.com/images/content/typescript_number_domain_without_null_and_undefined-2x.ni7cmeejbe.imm.png" alt="Domains of TypeScript&#39;s number, null, and undefined types"></p><p>启用严格空检查模式后，将 <code>null</code> 和 <code>undefined</code> 赋值给任何变量都会导致错误：</p><pre><code>// 使用 --strictNullChecks flag 编译的结果

let name: string;
name = &quot;Marius&quot;;  // OK
name = null;      // Error
name = undefined; // Error

let age: number;
age = 24;        // OK
age = null;      // Error
age = undefined; // Error

let isMarried: boolean;
isMarried = true;      // OK
isMarried = false;     // OK
isMarried = null;      // Error
isMarried = undefined; // Error
</code></pre><p>那么，我们如何在 TypeScript 2.0 中表示可为空变量呢？</p><h2 id="使用联合类型构建可为空变量"><a class="header-anchor" href="#使用联合类型构建可为空变量" aria-hidden="true">#</a> <a href="#modeling-nullability-with-union-types">#</a>使用联合类型构建可为空变量</h2><p>由于启用严格空检查后，各个类型默认都是非空的，所以，我们需要明确告诉类型检查器一个变量是可为空的。这可以通过将 <code>null</code> 和 <code>undefined</code> 混入联合类型做到的：</p><pre><code>let name: string | null;
name = &quot;Marius&quot;;  // OK
name = null;      // OK
name = undefined; // Error
</code></pre><p>注意，<code>undefined</code> 并不是可以赋值给变量 <code>name</code> 的有效值，因为联合类型中并没有包含 <code>undefined</code>。</p><p>这种表示可为空变量的方式非常直观。我们以一个简单的 <code>User</code> 类型为例：</p><pre><code>type User = {
  firstName: string;
  lastName: string | undefined;
};

let jane: User = { firstName: &quot;Jane&quot;, lastName: undefined };
let john: User = { firstName: &quot;John&quot;, lastName: &quot;Doe&quot; };
</code></pre><p>我们可以通过在 <code>lastName</code> 后面加 <code>?</code> 的方式将属性标记为可选的。除此之外，<code>undefined</code> 会自动添加到联合类型。因此，下面的赋值都是类型正确（type-correct）的：</p><pre><code>type User = {
  firstName: string;
  lastName?: string;
};

// We can assign a string to the &quot;lastName&quot; property
let john: User = { firstName: &quot;John&quot;, lastName: &quot;Doe&quot; };

// ... or we can explicitly assign the value undefined
let jane: User = { firstName: &quot;Jane&quot;, lastName: undefined };

// ... or we can not define the property at all
let jake: User = { firstName: &quot;Jake&quot; };
</code></pre><h2 id="访问可为空属性"><a class="header-anchor" href="#访问可为空属性" aria-hidden="true">#</a> <a href="#property-access-with-nullable-types">#</a>访问可为空属性</h2><p>如果一个对象变量是可为空的，直接访问它的任意属性都会导致编译期错误（compil-time error）：</p><pre><code>function getLength(s: string | null) {
  // Error: Object is possibly &#39;null&#39;.
  return s.length;
}
</code></pre><p>访问属性前，需要使用 type guard 保证访问对象属性是安全的：</p><pre><code>function getLength(s: string | null) {
  if (s === null) {
    return 0;
  }

  return s.length;
</code></pre><p>TypeScript 理解 JavaScript 的真值语义（truthiness semantics），支持条件表达式中的 type guard。因此，下面这种检查方式也是可以的：</p><pre><code>function getLength(s: string | null) {
  return s ? s.length : 0;
}
</code></pre><h2 id="调用可为空函数"><a class="header-anchor" href="#调用可为空函数" aria-hidden="true">#</a> <a href="#function-invocations-with-nullable-types">#</a>调用可为空函数</h2><p>如果一个函数是可为空的，直接调用它就会导致编译期错误（compil-time error）。以下面的 <code>callback</code> 参数为例：</p><pre><code>function doSomething(callback?: () =&gt; void) {
  // Error: Object is possibly &#39;undefined&#39;.
  callback();
}
</code></pre><p>类似于访问对象属性前的检查，在调用函数前也要先检查，以便确保不是空值：</p><pre><code>function doSomething(callback?: () =&gt; void) {
  if (callback) {
    callback();
  }
}
</code></pre><p>如果喜欢，还能通过 <code>typeof</code> 操作符的返回值确保不是空值：</p><pre><code>function doSomething(callback?: () =&gt; void) {
  if (typeof callback === &quot;function&quot;) {
    callback();
  }
}
</code></pre><h2 id="总结"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> <a href="#summary">#</a>总结</h2><p>非空类型是 TypeScript 类型系统中非常基础和有价值的一个功能。它允许我们明确指定变量或属性是不是可为空，确保属性访问和函数调用是安全的，避免了编译期间的空值错误。</p><p>本篇文章是 <a href="https://mariusschulz.com/blog/series/typescript-evolution" target="_blank" rel="noopener noreferrer">TypeScript Evolution</a> 系列中的一篇。</p></div></div><footer class="page-footer" data-v-d36a7fda data-v-5a019cc9><div class="edit" data-v-5a019cc9><div class="edit-link" data-v-5a019cc9 data-v-fb0131f2><a class="link" href="https://github.com/baooab/dev-tricks/edit/master/docs/typescript/non-nullable-types-in-typescript.md" target="_blank" rel="noopener noreferrer" data-v-fb0131f2>在 GitHub 上编辑此页 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-fb0131f2><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-5a019cc9><p class="last-updated" data-v-5a019cc9 data-v-52854a16><span class="prefix" data-v-52854a16>最近更新:</span><span class="datetime" data-v-52854a16></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"88b60a58\",\"jquery.md\":\"415da445\",\"drafts_grunt.md\":\"3bb005e4\",\"git_vitepress-deploy-to-github.md\":\"82df0379\",\"misc_eol-lf.md\":\"07af27b0\",\"npm_install-peerdeps.md\":\"59897465\",\"npm_lerna.md\":\"b677e1d4\",\"typescript_non-nullable-types-in-typescript.md\":\"5c3e0dab\",\"weekly_issue-38.md\":\"dd0ca661\",\"weekly_issue-39.md\":\"0189b4fd\",\"weekly_issue-40.md\":\"d96b8158\",\"weekly_issue-41.md\":\"a36fb9e6\"}")</script>
    <script type="module" async src="/dev-tricks/assets/app.d2ac5229.js"></script>
  </body>
</html>